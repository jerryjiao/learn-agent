# Langfuse Docker Compose éƒ¨ç½²æŒ‡å—

> **é€‚ç”¨åœºæ™¯**: æœ¬åœ°å¼€å‘ã€æµ‹è¯•ç¯å¢ƒã€å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ
> 
> **ç›®æ ‡è¯»è€…**: å¤§æ¨¡å‹æ™ºèƒ½ä½“è¯„ä¼°ä¸­é«˜çº§å­¦ä¹ è€…
> 
> **ç‰ˆæœ¬**: Langfuse v3 / Docker Compose

---

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
  - [æ­¥éª¤ 5: åˆ›å»ºç”¨æˆ·ã€ç»„ç»‡å’Œé¡¹ç›®](#æ­¥éª¤-5-åˆ›å»ºç”¨æˆ·ç»„ç»‡å’Œé¡¹ç›®)
  - [æ­¥éª¤ 6: è·å– API å¯†é’¥](#æ­¥éª¤-6-è·å–-api-å¯†é’¥)
- [è¯¦ç»†é…ç½®è¯´æ˜](#è¯¦ç»†é…ç½®è¯´æ˜)
- [å®‰å…¨åŠ å›º](#å®‰å…¨åŠ å›º)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ•°æ®å¤‡ä»½ä¸æ¢å¤](#æ•°æ®å¤‡ä»½ä¸æ¢å¤)
- [å‡çº§æŒ‡å—](#å‡çº§æŒ‡å—)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### Langfuse æ˜¯ä»€ä¹ˆï¼Ÿ

Langfuse æ˜¯ä¸€ä¸ªå¼€æºçš„ LLM å·¥ç¨‹å¹³å°ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **è¿½è¸ªä¸ç›‘æ§**: è®°å½•å’Œå¯è§†åŒ– LLM åº”ç”¨çš„æ¯ä¸€æ¬¡è°ƒç”¨
- **æç¤ºè¯ç®¡ç†**: ç‰ˆæœ¬æ§åˆ¶ã€A/B æµ‹è¯•ã€æç¤ºè¯ä¼˜åŒ–
- **è¯„ä¼°ä¸æ ‡æ³¨**: è‡ªåŠ¨åŒ–å’Œäººå·¥è¯„ä¼° LLM è¾“å‡ºè´¨é‡
- **æ•°æ®é›†ç®¡ç†**: æ„å»ºæµ‹è¯•æ•°æ®é›†ï¼ŒæŒç»­è¯„ä¼°æ¨¡å‹æ€§èƒ½
- **æˆæœ¬åˆ†æ**: è¿½è¸ª Token ä½¿ç”¨å’Œ API è°ƒç”¨æˆæœ¬

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Langfuse ç³»ç»Ÿæ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Langfuse Web â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Langfuse Workerâ”‚                  â”‚
â”‚  â”‚  (ç«¯å£ 3000) â”‚        â”‚  (ç«¯å£ 3030)  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                       â”‚                            â”‚
â”‚         â–¼                       â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  PostgreSQL  â”‚        â”‚  ClickHouse  â”‚                   â”‚
â”‚  â”‚  (ç«¯å£ 5432) â”‚        â”‚  (ç«¯å£ 8123) â”‚                   â”‚
â”‚  â”‚  å…³ç³»å‹æ•°æ®   â”‚        â”‚  åˆ—å¼æ•°æ®åº“   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                       â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚    Redis     â”‚                                â”‚
â”‚              â”‚  (ç«¯å£ 6379) â”‚                                â”‚
â”‚              â”‚  ç¼“å­˜/é˜Ÿåˆ—    â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚    MinIO     â”‚                                â”‚
â”‚              â”‚  (ç«¯å£ 9090) â”‚                                â”‚
â”‚              â”‚  å¯¹è±¡å­˜å‚¨     â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è¯´æ˜

| ç»„ä»¶ | èŒè´£ | èµ„æºéœ€æ±‚ | ç«¯å£ |
|------|------|---------|------|
| **langfuse-web** | Web UI å’Œ REST API | 2GB å†…å­˜ | 3000 |
| **langfuse-worker** | åå°ä»»åŠ¡å¤„ç† | 2GB å†…å­˜ | 3030 |
| **PostgreSQL** | å…ƒæ•°æ®å­˜å‚¨ | 2GB å†…å­˜, 20GB ç£ç›˜ | 5432 |
| **ClickHouse** | è¿½è¸ªæ•°æ®å­˜å‚¨ | 4GB å†…å­˜, 100GB ç£ç›˜ | 8123, 9000 |
| **Redis** | ç¼“å­˜å’Œé˜Ÿåˆ— | 1GB å†…å­˜ | 6379 |
| **MinIO** | å¯¹è±¡å­˜å‚¨ | 1GB å†…å­˜, 50GB ç£ç›˜ | 9090, 9091 |

**æ¨èé…ç½®**: 
- **æœ€å°é…ç½®**: 4 æ ¸ CPU, 8GB å†…å­˜, 100GB ç£ç›˜
- **æ¨èé…ç½®**: 8 æ ¸ CPU, 16GB å†…å­˜, 200GB ç£ç›˜
- **é«˜è´Ÿè½½é…ç½®**: 16 æ ¸ CPU, 32GB å†…å­˜, 500GB ç£ç›˜

---

## âœ… å‰ç½®è¦æ±‚

### 1. æ“ä½œç³»ç»Ÿ

æ”¯æŒä»¥ä¸‹æ“ä½œç³»ç»Ÿï¼š

- âœ… Linux (Ubuntu 22.04+, CentOS 8+, Debian 11+)
- âœ… macOS 12+ (ä½¿ç”¨ Docker Desktop)
- âœ… Windows 10/11 (ä½¿ç”¨ WSL2 + Docker Desktop)

### 2. è½¯ä»¶ä¾èµ–

#### å¿…éœ€è½¯ä»¶

```bash
# Git (ç”¨äºå…‹éš†ä»“åº“)
git --version  # éœ€è¦ 2.0+

# Docker (å®¹å™¨è¿è¡Œæ—¶)
docker --version  # éœ€è¦ 20.10+

# Docker Compose (å®¹å™¨ç¼–æ’)
docker compose version  # éœ€è¦ 2.0+
```

#### å®‰è£… Docker å’Œ Docker Compose

**Ubuntu/Debian:**

```bash
# æ›´æ–°åŒ…ç´¢å¼•
sudo apt-get update

# å®‰è£…ä¾èµ–
sudo apt-get install -y ca-certificates curl

# æ·»åŠ  Docker GPG å¯†é’¥
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# æ·»åŠ  Docker ä»“åº“
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# å®‰è£… Docker
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# éªŒè¯å®‰è£…
sudo docker run hello-world
```

**macOS/Windows:**

ä¸‹è½½å¹¶å®‰è£… [Docker Desktop](https://www.docker.com/products/docker-desktop/)

### 3. ç½‘ç»œè¦æ±‚

- **å¤–ç½‘è®¿é—®**: éœ€è¦èƒ½è®¿é—® Docker Hub æ‹‰å–é•œåƒ
- **ç«¯å£å¼€æ”¾**: ç¡®ä¿ä»¥ä¸‹ç«¯å£æœªè¢«å ç”¨
  - `3000`: Langfuse Web ç•Œé¢
  - `9090`: MinIO API (å¯é€‰ï¼Œå¦‚éœ€å¤–éƒ¨ä¸Šä¼ åª’ä½“æ–‡ä»¶)
  - `9091`: MinIO ç®¡ç†æ§åˆ¶å° (æœ¬æœºè®¿é—®)

### 4. é˜²ç«å¢™é…ç½®ï¼ˆäº‘æœåŠ¡å™¨ï¼‰

å¦‚æœåœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²ï¼Œéœ€è¦é…ç½®å®‰å…¨ç»„/é˜²ç«å¢™è§„åˆ™ï¼š

```bash
# å…è®¸ Langfuse Web è®¿é—®
å…è®¸å…¥ç«™: TCP 3000 (æ¥æº: 0.0.0.0/0 æˆ–æŒ‡å®š IP)

# å…è®¸ MinIO API è®¿é—®ï¼ˆå¯é€‰ï¼‰
å…è®¸å…¥ç«™: TCP 9090 (æ¥æº: 0.0.0.0/0 æˆ–æŒ‡å®š IP)

# å»ºè®®ç¦æ­¢å…¶ä»–ç«¯å£çš„å¤–éƒ¨è®¿é—®
æ‹’ç»å…¥ç«™: TCP 5432, 6379, 8123, 9000, 9001, 3030
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å…‹éš†ä»“åº“

```bash
# å…‹éš†ä»£ç 
git clone https://github.com/FlyAIBox/Agent_In_Action.git

# è¿›å…¥ç›®å½•
cd 04-agent-evaluation/langfuse/docker
```

### æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp env.dev.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

**æœ€å°å¿…è¦é…ç½® (`.env` æ–‡ä»¶å†…å®¹):**

```bash
# =============================================================================
# Langfuse æ ¸å¿ƒé…ç½®
# =============================================================================

# 1. æ•°æ®åº“å¯†ç ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
POSTGRES_PASSWORD=postgres
CLICKHOUSE_PASSWORD=clickhouse

# 2. åŠ å¯†å¯†é’¥ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
# ç”Ÿæˆæ–¹å¼: openssl rand -hex 32
ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000

# 3. ä¼šè¯å¯†é’¥ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
# ç”Ÿæˆæ–¹å¼: openssl rand -base64 32
NEXTAUTH_SECRET=mysecret

# 4. åŠ å¯†ç›å€¼ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
# ç”Ÿæˆæ–¹å¼: openssl rand -base64 32
SALT=mysalt

# 5. Redis å¯†ç ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
# ç”Ÿæˆæ–¹å¼: openssl rand -base64 24
REDIS_AUTH=myredissecret

# 6. MinIO å¯†ç ï¼ˆå¿…æ”¹ï¼ï¼‰
# âš ï¸ å½“å‰ä¸ºé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
# ç”Ÿæˆæ–¹å¼: openssl rand -base64 16
# è¦æ±‚: æœ€å°‘ 8 ä¸ªå­—ç¬¦
MINIO_ROOT_PASSWORD=miniosecret

# =============================================================================
# å¯é€‰é…ç½®
# =============================================================================
# æ— å¤´åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼‰
LANGFUSE_INIT_USER_EMAIL=admin@example.com
LANGFUSE_INIT_USER_PASSWORD=your_admin_password
LANGFUSE_INIT_USER_NAME=Admin
LANGFUSE_INIT_ORG_NAME=AGENT AI
LANGFUSE_INIT_PROJECT_NAME=Agent101
```

**ç”Ÿæˆå®‰å…¨å¯†é’¥å‘½ä»¤:**

```bash
# ç”Ÿæˆ ENCRYPTION_KEY (64ä½åå…­è¿›åˆ¶)
openssl rand -hex 32

# ç”Ÿæˆ NEXTAUTH_SECRET (Base64)
openssl rand -base64 32

# ç”Ÿæˆéšæœºå¯†ç 
openssl rand -base64 24
```

### æ­¥éª¤ 3: å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆå‰å°è¿è¡Œï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼‰
docker compose up

# æˆ–è€…åå°è¿è¡Œ
docker compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs -f langfuse-web
```

**å¯åŠ¨è¿‡ç¨‹è¯´æ˜:**

1. **æ‹‰å–é•œåƒ** (é¦–æ¬¡è¿è¡Œï¼Œçº¦ 2-5 åˆ†é’Ÿ)
   ```
   Pulling postgres ... done
   Pulling redis    ... done
   Pulling clickhouse ... done
   Pulling minio    ... done
   Pulling langfuse-worker ... done
   Pulling langfuse-web ... done
   ```

2. **åˆå§‹åŒ–æ•°æ®åº“** (çº¦ 1-2 åˆ†é’Ÿ)
   - PostgreSQL æ•°æ®åº“è¡¨åˆ›å»º
   - ClickHouse æ•°æ®åº“è¡¨åˆ›å»º
   - MinIO å­˜å‚¨æ¡¶åˆ›å»º

3. **æœåŠ¡å°±ç»ª** (çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºæˆåŠŸ)
   ```
   langfuse-web-1    | Ready started server on 0.0.0.0:3000, url: http://192.168.172.128:3000
   ```

### æ­¥éª¤ 4: è®¿é—® Langfuse

æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://192.168.172.128:3000**

**é¦–æ¬¡è®¿é—®:**

- å¦‚æœé…ç½®äº†æ— å¤´åˆå§‹åŒ–ï¼Œç›´æ¥ä½¿ç”¨é…ç½®çš„é‚®ç®±å¯†ç ç™»å½•
- å¦‚æœæœªé…ç½®ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°æ³¨å†Œé¡µé¢ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·

**è®¿é—® MinIO ç®¡ç†æ§åˆ¶å° (å¯é€‰):**

è®¿é—®: **http://localhost:9091**

- ç”¨æˆ·å: `minio` (æˆ–æ‚¨åœ¨ `.env` ä¸­è®¾ç½®çš„ `MINIO_ROOT_USER`)
- å¯†ç : æ‚¨åœ¨ `.env` ä¸­è®¾ç½®çš„ `MINIO_ROOT_PASSWORD`

### æ­¥éª¤ 5: åˆ›å»ºç”¨æˆ·ã€ç»„ç»‡å’Œé¡¹ç›®

#### æ–¹å¼ä¸€: ä½¿ç”¨æ— å¤´åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®äº†æ— å¤´åˆå§‹åŒ–å‚æ•°ï¼Œç³»ç»Ÿä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼š

- âœ… ç®¡ç†å‘˜ç”¨æˆ·è´¦æˆ·
- âœ… ç»„ç»‡ï¼ˆOrganizationï¼‰
- âœ… é¡¹ç›®ï¼ˆProjectï¼‰
- âœ… API å¯†é’¥ï¼ˆPublic Key å’Œ Secret Keyï¼‰

**é…ç½®ç¤ºä¾‹:**

```bash
# .env æ–‡ä»¶
LANGFUSE_INIT_USER_EMAIL=admin@example.com
LANGFUSE_INIT_USER_PASSWORD=your_admin_password
LANGFUSE_INIT_USER_NAME=Admin
LANGFUSE_INIT_ORG_NAME=AGENT AI
LANGFUSE_INIT_PROJECT_NAME=Agent101
```

å¯åŠ¨åï¼Œç›´æ¥ä½¿ç”¨é…ç½®çš„é‚®ç®±å’Œå¯†ç ç™»å½•å³å¯ã€‚

#### æ–¹å¼äºŒ: æ‰‹åŠ¨åˆ›å»ºï¼ˆWeb ç•Œé¢ï¼‰

å¦‚æœæœªé…ç½®æ— å¤´åˆå§‹åŒ–ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š

##### 5.1 åˆ›å»ºç”¨æˆ·è´¦æˆ·

1. **é¦–æ¬¡è®¿é—®**: æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://192.168.172.128:3000`ï¼ˆæˆ–æ‚¨çš„æœåŠ¡å™¨åœ°å€ï¼‰
2. **æ³¨å†Œè´¦æˆ·**: 
   - ç³»ç»Ÿä¼šè‡ªåŠ¨è·³è½¬åˆ°æ³¨å†Œé¡µé¢
   - å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
     - **Email**: æ‚¨çš„é‚®ç®±åœ°å€ï¼ˆå¦‚ `admin@example.com`ï¼‰
     - **Password**: è®¾ç½®ç™»å½•å¯†ç 
     - **Name**: æ‚¨çš„å§“åï¼ˆå¦‚ `Admin`ï¼‰
3. **å®Œæˆæ³¨å†Œ**: ç‚¹å‡» "Sign Up" æŒ‰é’®
4. **ç™»å½•ç³»ç»Ÿ**: ä½¿ç”¨æ³¨å†Œçš„é‚®ç®±å’Œå¯†ç ç™»å½•

##### 5.2 åˆ›å»ºç»„ç»‡ï¼ˆOrganizationï¼‰
![LangFuse-åˆ›å»ºç»„ç»‡](../img/01-LangFuse-åˆ›å»ºç»„ç»‡.png)
1. ç¬¬ä¸€æ¬¡ç™»å½•åï¼Œä¼šé»˜è®¤ç›´æ¥è¿›å…¥**Organizations**ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·ç»§ç»­ç¬¬äºŒæ­¥ã€‚
2. **é€‰æ‹©ç»„ç»‡**: åœ¨å·¦ä¾§èœå•é€‰æ‹© **Organizations**
3. **åˆ›å»ºç»„ç»‡**:
   - ç‚¹å‡» **"New Organization"** æŒ‰é’®
   - å¡«å†™ç»„ç»‡ä¿¡æ¯ï¼š
     - **Name**: ç»„ç»‡åç§°ï¼ˆå¦‚ `AGENT AI`ï¼‰
   - ç‚¹å‡» **"Create"** å®Œæˆåˆ›å»º
4. **Invite Members**: é»˜è®¤ä¼šå…³è”ç®¡ç†å‘˜ã€‚å¯ä»¥ **"Next"** è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 

##### 5.3 åˆ›å»ºé¡¹ç›®ï¼ˆProjectï¼‰
![LangFuse-åˆ›å»ºé¡¹ç›®](../img/02-LangFuse-åˆ›å»ºé¡¹ç›®.png)
1. **è¿›å…¥é¡¹ç›®é¡µé¢**: 
   - é»˜è®¤ç›´æ¥è¿›å…¥åˆ›å»ºé¡¹ç›®é¡µé¢ï¼Œæˆ–ç‚¹å‡»å·¦ä¾§èœå•çš„ **Projects**
2. **åˆ›å»ºé¡¹ç›®**:
   - ç‚¹å‡» **"New Project"** æŒ‰é’®
   - å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
     - **Name**: é¡¹ç›®åç§°ï¼ˆå¦‚ `Agent101`ï¼‰
   - ç‚¹å‡» **"Create"** å®Œæˆåˆ›å»º
3. **é€‰æ‹©é¡¹ç›®**: åˆ›å»ºåï¼Œåœ¨é¡¹ç›®åˆ—è¡¨ä¸­ç‚¹å‡»é¡¹ç›®åç§°è¿›å…¥é¡¹ç›®è¯¦æƒ…é¡µ

**æ³¨æ„**: æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ç‹¬ç«‹çš„ API å¯†é’¥ï¼Œç”¨äºè¿½è¸ªè¯¥é¡¹ç›®çš„ LLM è°ƒç”¨æ•°æ®ã€‚

---

### æ­¥éª¤ 6: è·å– API å¯†é’¥
![LangFuse-åˆ›å»ºAPIKeys](../img/03-LangFuse-åˆ›å»ºAPIKeys.png)

API å¯†é’¥ç”¨äºåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­é›†æˆ Langfuse SDKï¼Œè¿½è¸ª LLM è°ƒç”¨æ•°æ®ã€‚

#### 6.1 è·å–é¡¹ç›® API å¯†é’¥

1. **è¿›å…¥é¡¹ç›®è®¾ç½®**:
   - ç™»å½• Langfuse Web ç•Œé¢
   - é€‰æ‹©è¦ä½¿ç”¨çš„é¡¹ç›®ï¼ˆç‚¹å‡»å·¦ä¾§èœå•çš„ **Projects**ï¼Œç„¶åé€‰æ‹©é¡¹ç›®ï¼‰
   - è¿›å…¥é¡¹ç›®åï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **Settings** â†’ **API Keys**

2. **æŸ¥çœ‹ API å¯†é’¥**:
   - åœ¨ API Keys é¡µé¢ï¼Œç‚¹å‡»æ‚¨ä¼š **Create API Keys** çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š
     - **Public Key** (å…¬é’¥): æ ¼å¼ä¸º `pk-lf-xxxxx-xxxxx-xxxxx-xxxxx`
     - **Secret Key** (ç§é’¥): æ ¼å¼ä¸º `sk-lf-xxxxx-xxxxx-xxxxx-xxxxx`
     - **Host** (æœåŠ¡å™¨åœ°å€): æ‚¨çš„ Langfuse æœåŠ¡å™¨åœ°å€

3. **å¤åˆ¶å¯†é’¥**:
   - ç‚¹å‡» **"Copy"** æŒ‰é’®å¤åˆ¶å¯†é’¥åˆ°å‰ªè´´æ¿

**ç¤ºä¾‹ API å¯†é’¥ä¿¡æ¯:**

```bash
# åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›å¯†é’¥
LANGFUSE_PUBLIC_KEY = "pk-lf-72a365cd-b256-48b6-9dfc-3c41f65c97f1"
LANGFUSE_SECRET_KEY = "sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9"
LANGFUSE_BASE_URL = "http://192.168.172.128:3000"
```

#### 6.2 é…ç½® LANGFUSE_BASE_URL

**LANGFUSE_BASE_URL** æ˜¯æ‚¨çš„ Langfuse æœåŠ¡å™¨åœ°å€ï¼Œæ ¹æ®éƒ¨ç½²ç¯å¢ƒä¸åŒï¼š

- **æœ¬åœ°å¼€å‘**: `http://192.168.172.128:3000`
- **å±€åŸŸç½‘è®¿é—®**: `http://<æœåŠ¡å™¨å†…ç½‘IP>:3000`ï¼ˆå¦‚ `http://192.168.172.128:3000`ï¼‰
- **å…¬ç½‘è®¿é—®**: `http://<æœåŠ¡å™¨å…¬ç½‘IP>:3000` æˆ– `https://langfuse.yourdomain.com`

**è·å–æœåŠ¡å™¨ IP åœ°å€:**

```bash
# Linux/macOS
# æŸ¥çœ‹å†…ç½‘ IP
ip addr show | grep "inet " | grep -v 127.0.0.1

# æˆ–ä½¿ç”¨
hostname -I

# æŸ¥çœ‹å…¬ç½‘ IPï¼ˆå¦‚æœåœ¨äº‘æœåŠ¡å™¨ï¼‰
curl ifconfig.me
```

#### 6.3 åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ API å¯†é’¥

**Python ç¤ºä¾‹:**

```python
from langfuse import Langfuse

# åˆå§‹åŒ– Langfuse å®¢æˆ·ç«¯
langfuse = Langfuse(
    public_key="pk-lf-72a365cd-b256-48b6-9dfc-3c41f65c97f1",
    secret_key="sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9",
    host="http://192.168.172.128:3000"
)

# è¿½è¸ª LLM è°ƒç”¨
trace = langfuse.trace(
    name="my-trace",
    user_id="user-123"
)
```

**JavaScript/TypeScript ç¤ºä¾‹:**

```typescript
import { Langfuse } from "langfuse";

// åˆå§‹åŒ– Langfuse å®¢æˆ·ç«¯
const langfuse = new Langfuse({
  publicKey: "pk-lf-72a365cd-b256-48b6-9dfc-3c41f65c97f1",
  secretKey: "sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9",
  baseUrl: "http://192.168.172.128:3000"
});

// è¿½è¸ª LLM è°ƒç”¨
const trace = langfuse.trace({
  name: "my-trace",
  userId: "user-123"
});
```

#### 6.4 å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦å®‰å…¨æç¤º**:

1. **ä¿æŠ¤ Secret Key**: 
   - Secret Key å…·æœ‰å®Œæ•´è®¿é—®æƒé™ï¼Œè¯·å‹¿æ³„éœ²
   - ä¸è¦å°† Secret Key æäº¤åˆ°ä»£ç ä»“åº“
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡å­˜å‚¨

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡**:
   ```bash
   # .env æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° Gitï¼‰
   export LANGFUSE_PUBLIC_KEY="pk-lf-72a365cd-b256-48b6-9dfc-3c41f65c97f1"
   export LANGFUSE_SECRET_KEY="sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9"
   export LANGFUSE_BASE_URL="http://192.168.172.128:3000"
   ```

3. **å®šæœŸè½®æ¢å¯†é’¥**:
   - åœ¨é¡¹ç›®è®¾ç½®ä¸­å¯ä»¥åˆ›å»ºæ–°çš„ API å¯†é’¥
   - åˆ é™¤ä¸å†ä½¿ç”¨çš„æ—§å¯†é’¥

4. **æƒé™ç®¡ç†**:
   - ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„ API å¯†é’¥
   - å›¢é˜Ÿæˆå‘˜å¯ä»¥å…±äº« Public Keyï¼Œä½† Secret Key åº”é™åˆ¶è®¿é—®

#### 6.5 éªŒè¯ API å¯†é’¥

æµ‹è¯• API å¯†é’¥æ˜¯å¦é…ç½®æ­£ç¡®:

```bash
# ä½¿ç”¨ curl æµ‹è¯•
curl -X GET "http://192.168.172.128:3000/api/public/health" \
  -H "Authorization: Bearer sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9"

# æˆ–ä½¿ç”¨ Python
python -c "
from langfuse import Langfuse
langfuse = Langfuse(
    public_key='pk-lf-72a365cd-b256-48b6-9dfc-3c41f65c97f1',
    secret_key='sk-lf-d94a06ae-12e9-443a-bfb3-cf48d56e93f9',
    host='http://192.168.172.128:3000'
)
print('API å¯†é’¥éªŒè¯æˆåŠŸï¼')
"
```

---

## ğŸ”§ è¯¦ç»†é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡å®Œæ•´åˆ—è¡¨

#### æ ¸å¿ƒè®¤è¯é…ç½®

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | å¿…æ”¹ |
|--------|------|--------|------|
| `NEXTAUTH_URL` | åº”ç”¨è®¿é—® URL | `http://192.168.172.128:3000` | ç”Ÿäº§ç¯å¢ƒå¿…æ”¹ |
| `NEXTAUTH_SECRET` | JWT ç­¾åå¯†é’¥ | `mysecret` | âœ… æ˜¯ |
| `DATABASE_URL` | PostgreSQL è¿æ¥ä¸² | `postgresql://postgres:postgres@postgres:5432/postgres` | âœ… æ˜¯ (æ”¹å¯†ç ) |
| `SALT` | åŠ å¯†ç›å€¼ | `mysalt` | âœ… æ˜¯ |
| `ENCRYPTION_KEY` | AES-256 åŠ å¯†å¯†é’¥ | `0000...` | âœ… æ˜¯ |

#### ClickHouse é…ç½®

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | å¿…æ”¹ |
|--------|------|--------|------|
| `CLICKHOUSE_URL` | HTTP API åœ°å€ | `http://clickhouse:8123` | å¦ |
| `CLICKHOUSE_MIGRATION_URL` | è¿ç§»è¿æ¥åœ°å€ | `clickhouse://clickhouse:9000` | å¦ |
| `CLICKHOUSE_USER` | ç”¨æˆ·å | `clickhouse` | å¦ |
| `CLICKHOUSE_PASSWORD` | å¯†ç  | `clickhouse` | âœ… æ˜¯ |
| `CLICKHOUSE_CLUSTER_ENABLED` | é›†ç¾¤æ¨¡å¼ | `false` | å¦ |

#### Redis é…ç½®

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | å¿…æ”¹ |
|--------|------|--------|------|
| `REDIS_HOST` | ä¸»æœºåœ°å€ | `redis` | å¦ |
| `REDIS_PORT` | ç«¯å£ | `6379` | å¦ |
| `REDIS_AUTH` | å¯†ç  | `myredissecret` | âœ… æ˜¯ |
| `REDIS_TLS_ENABLED` | å¯ç”¨ TLS | `false` | å¦ |

#### MinIO / S3 é…ç½®

**äº‹ä»¶æ•°æ®å­˜å‚¨:**

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `LANGFUSE_S3_EVENT_UPLOAD_BUCKET` | å­˜å‚¨æ¡¶å | `langfuse` |
| `LANGFUSE_S3_EVENT_UPLOAD_ACCESS_KEY_ID` | è®¿é—®å¯†é’¥ ID | `minio` |
| `LANGFUSE_S3_EVENT_UPLOAD_SECRET_ACCESS_KEY` | è®¿é—®å¯†é’¥ | `miniosecret` âœ… å¿…æ”¹ |
| `LANGFUSE_S3_EVENT_UPLOAD_ENDPOINT` | å†…éƒ¨ç«¯ç‚¹ | `http://minio:9000` |

**åª’ä½“æ–‡ä»¶ä¸Šä¼ :**

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `LANGFUSE_S3_MEDIA_UPLOAD_ENDPOINT` | å¤–éƒ¨ç«¯ç‚¹ | `http://localhost:9090` |
| `LANGFUSE_S3_MEDIA_UPLOAD_SECRET_ACCESS_KEY` | è®¿é—®å¯†é’¥ | `miniosecret` âœ… å¿…æ”¹ |

**æ‰¹é‡å¯¼å‡º:**

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `LANGFUSE_S3_BATCH_EXPORT_ENABLED` | å¯ç”¨å¯¼å‡º | `false` |
| `LANGFUSE_S3_BATCH_EXPORT_EXTERNAL_ENDPOINT` | ä¸‹è½½ç«¯ç‚¹ | `http://localhost:9090` |

#### æ— å¤´åˆå§‹åŒ–é…ç½®

| å˜é‡å | è¯´æ˜ | ç”¨é€” |
|--------|------|------|
| `LANGFUSE_INIT_USER_EMAIL` | ç®¡ç†å‘˜é‚®ç®± | è‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· |
| `LANGFUSE_INIT_USER_PASSWORD` | ç®¡ç†å‘˜å¯†ç  | ç™»å½•å‡­è¯ |
| `LANGFUSE_INIT_USER_NAME` | ç®¡ç†å‘˜å§“å | æ˜¾ç¤ºåç§° |
| `LANGFUSE_INIT_ORG_NAME` | ç»„ç»‡åç§° | è‡ªåŠ¨åˆ›å»ºç»„ç»‡ |
| `LANGFUSE_INIT_PROJECT_NAME` | é¡¹ç›®åç§° | è‡ªåŠ¨åˆ›å»ºé¡¹ç›® |
| `LANGFUSE_INIT_PROJECT_PUBLIC_KEY` | é¡¹ç›®å…¬é’¥ | ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ |
| `LANGFUSE_INIT_PROJECT_SECRET_KEY` | é¡¹ç›®ç§é’¥ | ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ |

#### é‚®ä»¶æœåŠ¡é…ç½®

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `EMAIL_FROM_ADDRESS` | å‘ä»¶äººåœ°å€ | `noreply@yourdomain.com` |
| `SMTP_CONNECTION_URL` | SMTP è¿æ¥ URL | `smtp://user:pass@smtp.gmail.com:587` |

**é…ç½®é‚®ä»¶æœåŠ¡åå¯ç”¨åŠŸèƒ½:**
- ç”¨æˆ·é‚€è¯·é‚®ä»¶
- å¯†ç é‡ç½®é‚®ä»¶
- ç³»ç»Ÿå‘Šè­¦é€šçŸ¥

---

## ğŸ”’ å®‰å…¨åŠ å›º

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•

#### âœ… 1. ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 

```bash
# æ£€æŸ¥ä»¥ä¸‹å˜é‡æ˜¯å¦å·²ä¿®æ”¹
POSTGRES_PASSWORD=postgres          # âŒ ä¸å®‰å…¨
CLICKHOUSE_PASSWORD=clickhouse      # âŒ ä¸å®‰å…¨
REDIS_AUTH=myredissecret            # âŒ ä¸å®‰å…¨
MINIO_ROOT_PASSWORD=miniosecret     # âŒ ä¸å®‰å…¨
NEXTAUTH_SECRET=mysecret            # âŒ ä¸å®‰å…¨
SALT=mysalt                         # âŒ ä¸å®‰å…¨
```

**å»ºè®®å¯†ç ç­–ç•¥:**
- é•¿åº¦ â‰¥ 16 å­—ç¬¦
- åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
- ä½¿ç”¨å¯†ç ç”Ÿæˆå™¨ç”Ÿæˆ

#### âœ… 2. é…ç½® HTTPS

**æ–¹å¼ä¸€: ä½¿ç”¨ Nginx åå‘ä»£ç†**

åˆ›å»º `nginx.conf`:

```nginx
server {
    listen 80;
    server_name langfuse.yourdomain.com;
    
    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name langfuse.yourdomain.com;
    
    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/certs/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/privkey.pem;
    
    # å®‰å…¨å¤´éƒ¨
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    
    # åå‘ä»£ç†åˆ° Langfuse
    location / {
        proxy_pass http://192.168.172.128:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**æ–¹å¼äºŒ: ä½¿ç”¨ Caddy (è‡ªåŠ¨ HTTPS)**

åˆ›å»º `Caddyfile`:

```caddy
langfuse.yourdomain.com {
    reverse_proxy localhost:3000
}
```

å¯åŠ¨ Caddy:

```bash
caddy run --config Caddyfile
```

**æ›´æ–° Langfuse é…ç½®:**

```bash
# .env æ–‡ä»¶ä¸­æ›´æ–°
NEXTAUTH_URL=https://langfuse.yourdomain.com
```

#### âœ… 3. é™åˆ¶ç½‘ç»œè®¿é—®

**ä»…å¼€æ”¾å¿…è¦ç«¯å£:**

```bash
# é˜²ç«å¢™é…ç½® (Ubuntu/UFW)
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable

# äº‘æœåŠ¡å™¨å®‰å…¨ç»„
# ä»…å…è®¸: TCP 443 (0.0.0.0/0)
# æ‹’ç»: TCP 3000, 9090, 5432, 6379, 8123, 9000
```

**Docker ç½‘ç»œéš”ç¦»:**

åœ¨ `docker-compose.yml` ä¸­ä½¿ç”¨å†…éƒ¨ç½‘ç»œï¼š

```yaml
networks:
  langfuse-internal:
    internal: true
  langfuse-external:

services:
  langfuse-web:
    networks:
      - langfuse-internal
      - langfuse-external
  
  postgres:
    networks:
      - langfuse-internal  # ä»…å†…éƒ¨è®¿é—®
```

#### âœ… 4. å¯ç”¨ Redis TLS

ç”Ÿæˆè¯ä¹¦:

```bash
# ç”Ÿæˆ CA è¯ä¹¦
openssl req -x509 -nodes -newkey rsa:4096 -keyout ca.key -out ca.crt -days 3650

# ç”Ÿæˆ Redis æœåŠ¡å™¨è¯ä¹¦
openssl req -nodes -newkey rsa:4096 -keyout redis.key -out redis.csr
openssl x509 -req -in redis.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out redis.crt -days 3650
```

æ›´æ–°é…ç½®:

```yaml
# docker-compose.yml
redis:
  volumes:
    - ./certs:/certs:ro
  command: >
    --requirepass ${REDIS_AUTH}
    --tls-port 6379
    --port 0
    --tls-cert-file /certs/redis.crt
    --tls-key-file /certs/redis.key
    --tls-ca-cert-file /certs/ca.crt

# .env
REDIS_TLS_ENABLED=true
REDIS_TLS_CA=/certs/ca.crt
REDIS_TLS_CERT=/certs/redis.crt
REDIS_TLS_KEY=/certs/redis.key
```

#### âœ… 5. æ•°æ®åŠ å¯†

**å¯ç”¨æ•°æ®åº“åŠ å¯†:**

```bash
# PostgreSQL é€æ˜æ•°æ®åŠ å¯†
# éœ€è¦ PostgreSQL ä¼ä¸šç‰ˆæˆ–ç¬¬ä¸‰æ–¹æ‰©å±•

# ClickHouse åˆ—çº§åŠ å¯†
# åœ¨ Langfuse ä¸­å·²é€šè¿‡ ENCRYPTION_KEY å®ç°
```

#### âœ… 6. å®šæœŸå®‰å…¨å®¡è®¡

```bash
# æ£€æŸ¥å®¹å™¨å®‰å…¨æ¼æ´
docker scout cves langfuse/langfuse:3
docker scout cves postgres:17
docker scout cves clickhouse/clickhouse-server

# æ£€æŸ¥å¼€æ”¾ç«¯å£
sudo netstat -tuln | grep LISTEN

# æ£€æŸ¥ Docker å®¹å™¨æ—¥å¿—
docker compose logs --tail=100 | grep -i error
```

---

## â“ å¸¸è§é—®é¢˜

### 1. å®¹å™¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `docker compose up` æŠ¥é”™

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆ:**

#### ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :3000
sudo lsof -i :5432

# å…³é—­å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹ç«¯å£
# åœ¨ docker-compose.yml ä¸­ä¿®æ”¹:
ports:
  - "3001:3000"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

#### ç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç† Docker èµ„æº
docker system prune -a --volumes

# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
docker system df
```

#### å†…å­˜ä¸è¶³

```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# å¢åŠ  Docker Desktop å†…å­˜é™åˆ¶
# macOS/Windows: Docker Desktop â†’ Settings â†’ Resources â†’ Memory

# Linux: æ£€æŸ¥ç³»ç»Ÿå†…å­˜
cat /proc/meminfo
```

### 2. æ— æ³•è®¿é—® Langfuse Web ç•Œé¢

**ç—‡çŠ¶**: æµè§ˆå™¨æ— æ³•æ‰“å¼€ http://192.168.172.128:3000

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps

# 2. æŸ¥çœ‹æ—¥å¿—
docker compose logs langfuse-web

# 3. ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
# çœ‹åˆ° "Ready started server" æ—¥å¿—åå†è®¿é—®

# 4. å¦‚æœæ˜¯äº‘æœåŠ¡å™¨ï¼Œæ£€æŸ¥é˜²ç«å¢™
sudo ufw status
# ç¡®ä¿ 3000 ç«¯å£å·²å¼€æ”¾

# 5. ä½¿ç”¨æœåŠ¡å™¨ IP è®¿é—®
http://<æœåŠ¡å™¨å…¬ç½‘IP>:3000
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—ä¸­å‡ºç° "could not connect to database"

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. æ£€æŸ¥ PostgreSQL å¥åº·çŠ¶æ€
docker compose ps postgres

# 2. æ‰‹åŠ¨æµ‹è¯•æ•°æ®åº“è¿æ¥
docker compose exec postgres psql -U postgres -c "SELECT 1;"

# 3. æ£€æŸ¥å¯†ç é…ç½®æ˜¯å¦ä¸€è‡´
# ç¡®ä¿ docker-compose.yml å’Œ .env ä¸­çš„å¯†ç åŒ¹é…

# 4. é‡å¯æ•°æ®åº“æœåŠ¡
docker compose restart postgres
docker compose restart langfuse-web langfuse-worker
```

### 4. ClickHouse æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**: è¿½è¸ªæ•°æ®æŸ¥è¯¢ç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. å¢åŠ  ClickHouse å†…å­˜
# åœ¨ docker-compose.yml ä¸­æ·»åŠ :
clickhouse:
  environment:
    CLICKHOUSE_MAX_MEMORY_USAGE: 8000000000  # 8GB

# 2. æ£€æŸ¥ç£ç›˜ I/O
iostat -x 1

# 3. ä¼˜åŒ–æ•°æ®åˆ†åŒº
# ClickHouse è‡ªåŠ¨æŒ‰æ—¶é—´åˆ†åŒºï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

# 4. å®šæœŸæ¸…ç†æ—§æ•°æ®
# åœ¨ Langfuse UI: Settings â†’ Data Retention
```

### 5. MinIO åª’ä½“ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: ä¸Šä¼ å›¾ç‰‡/è§†é¢‘æ—¶æŠ¥é”™

**åŸå› **: MinIO å¤–éƒ¨ç«¯ç‚¹é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. æ£€æŸ¥ MinIO æ˜¯å¦å¯è®¿é—®
curl http://localhost:9090/minio/health/live

# 2. æ›´æ–°å¤–éƒ¨ç«¯ç‚¹é…ç½®
# æœ¬åœ°éƒ¨ç½²:
LANGFUSE_S3_MEDIA_UPLOAD_ENDPOINT=http://localhost:9090

# äº‘æœåŠ¡å™¨éƒ¨ç½²:
LANGFUSE_S3_MEDIA_UPLOAD_ENDPOINT=http://<æœåŠ¡å™¨å…¬ç½‘IP>:9090

# 3. ç¡®ä¿ 9090 ç«¯å£å·²å¼€æ”¾
sudo ufw allow 9090/tcp

# 4. é‡å¯æœåŠ¡
docker compose restart langfuse-web langfuse-worker
```

### 6. æ•°æ®ä¸¢å¤±é—®é¢˜

**ç—‡çŠ¶**: é‡å¯åæ•°æ®æ¶ˆå¤±

**åŸå› **: Volume æœªæ­£ç¡®æŒ‚è½½

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. æ£€æŸ¥ Volume æ˜¯å¦å­˜åœ¨
docker volume ls | grep langfuse

# 2. æ£€æŸ¥ Volume æŒ‚è½½
docker compose config | grep volumes

# 3. ä¸è¦ä½¿ç”¨ -v å‚æ•°åœæ­¢å®¹å™¨
docker compose down     # âœ… æ­£ç¡®
docker compose down -v  # âŒ ä¼šåˆ é™¤ Volumeï¼

# 4. æ¢å¤æ•°æ®ï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰
# å‚è€ƒ"æ•°æ®å¤‡ä»½ä¸æ¢å¤"ç« èŠ‚
```

### 7. æ—¥å¿—æ˜¾ç¤º "å‡†å¤‡æ—¶é—´è¿‡é•¿"

**ç—‡çŠ¶**: å¯åŠ¨è¶…è¿‡ 5 åˆ†é’Ÿä»æœªå°±ç»ª

**è§£å†³æ–¹æ¡ˆ:**

```bash
# 1. æ£€æŸ¥æ˜¯å¦é¦–æ¬¡è¿è¡Œï¼ˆéœ€è¦åˆå§‹åŒ–æ•°æ®åº“ï¼‰
# é¦–æ¬¡å¯åŠ¨çº¦éœ€ 3-5 åˆ†é’Ÿ

# 2. æ£€æŸ¥æ•°æ®åº“è¿ç§»çŠ¶æ€
docker compose logs langfuse-worker | grep migration

# 3. å¦‚æœè¿ç§»å¤±è´¥ï¼Œæ¸…ç©ºæ•°æ®åº“é‡è¯•
docker compose down -v
docker compose up

# 4. æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# 5. å¦‚æœ CPU/å†…å­˜ä¸è¶³ï¼Œå‡çº§æœºå™¨é…ç½®
```

---

## ğŸ“š æ‰©å±•é˜…è¯»

### å®˜æ–¹æ–‡æ¡£

- [Langfuse å®˜æ–¹æ–‡æ¡£](https://langfuse.com/docs)
- [è‡ªæ‰˜ç®¡éƒ¨ç½²æŒ‡å—](https://langfuse.com/self-hosting)
- [Docker Compose éƒ¨ç½²](https://langfuse.com/self-hosting/deployment/docker-compose)
- [Kubernetes éƒ¨ç½²](https://langfuse.com/self-hosting/deployment/kubernetes)

### SDK é›†æˆ

- [Python SDK](https://langfuse.com/docs/sdk/python)
- [JavaScript/TypeScript SDK](https://langfuse.com/docs/sdk/typescript)
- [LangChain é›†æˆ](https://langfuse.com/docs/integrations/langchain)
- [LlamaIndex é›†æˆ](https://langfuse.com/docs/integrations/llama-index)

### ä¼˜ç§€åšæ³•

- [æç¤ºè¯ç®¡ç†](https://langfuse.com/docs/prompts)
- [è¯„ä¼°ä¸æµ‹è¯•](https://langfuse.com/docs/scores)
- [æ•°æ®é›†ç®¡ç†](https://langfuse.com/docs/datasets)
- [æˆæœ¬è¿½è¸ª](https://langfuse.com/docs/cost)

---
