#!/bin/bash

###############################################################################
# AIæ—…è¡Œè§„åˆ’æ™ºèƒ½ä½“ - å‰ç«¯å¯åŠ¨è„šæœ¬
# 
# åŠŸèƒ½ï¼šå¿«é€Ÿå¯åŠ¨ä¼˜åŒ–åçš„Streamlitå‰ç«¯ç•Œé¢
# ä½œè€…ï¼šAI Travel Planner Team
# æ›´æ–°ï¼š2025-01-12
###############################################################################

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸŒ AIæ—…è¡Œè§„åˆ’æ™ºèƒ½ä½“ - å‰ç«¯å¯åŠ¨"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# æ£€æŸ¥Pythonç¯å¢ƒ
if ! command -v python3 &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ°Python3"
    echo "è¯·å…ˆå®‰è£…Python 3.8æˆ–æ›´é«˜ç‰ˆæœ¬"
    exit 1
fi

echo "âœ… Pythonç‰ˆæœ¬: $(python3 --version)"
echo ""

# æ£€æŸ¥Streamlit
if ! python3 -c "import streamlit" 2>/dev/null; then
    echo "âš ï¸  æœªæ£€æµ‹åˆ°Streamlitï¼Œæ­£åœ¨å®‰è£…..."
    pip install streamlit
    echo ""
fi

# æ£€æŸ¥åç«¯æœåŠ¡
echo "ğŸ” æ£€æŸ¥åç«¯æœåŠ¡..."
if curl -s http://192.168.172.128:8080/health > /dev/null 2>&1; then
    echo "âœ… åç«¯æœåŠ¡è¿è¡Œä¸­"
else
    echo "âš ï¸  åç«¯æœåŠ¡æœªè¿è¡Œ"
    echo ""
    echo "è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡ï¼š"
    echo "  cd backend && python api_server.py"
    echo ""
    echo "æˆ–è€…ä½¿ç”¨åå°å¯åŠ¨ï¼š"
    echo "  ./start_backend.sh"
    echo ""
    echo "å‰ç«¯ç•Œé¢å°†ç»§ç»­å¯åŠ¨ï¼Œä½†åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒ..."
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸš€ å¯åŠ¨å‰ç«¯æœåŠ¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“± è®¿é—®åœ°å€:"
echo "   Local:    http://192.168.172.128:8501"
echo "   Network:  http://$(hostname -I | awk '{print $1}'):8501"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "æŒ‰ Ctrl+C åœæ­¢æœåŠ¡"
echo ""

# åˆ‡æ¢åˆ°å‰ç«¯ç›®å½•å¹¶å¯åŠ¨
cd "$(dirname "$0")/frontend"

# å¯åŠ¨Streamlit
streamlit run streamlit_app.py \
    --server.port=8501 \
    --server.address=0.0.0.0 \
    --server.headless=true \
    --browser.gatherUsageStats=false
