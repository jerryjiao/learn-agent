# =============================================================================
# Easy Dataset Docker Compose 配置文件
# =============================================================================
# 
# 本文件用于配置和启动 Easy Dataset 应用容器
# Easy Dataset 是一个专为创建大型语言模型（LLM）微调数据集而设计的工具
# 
# 使用说明：
# 1. 确保已安装 Docker 和 Docker Compose
# 2. 在包含此文件的目录下执行：docker-compose up -d
# 3. 启动成功后，在浏览器中访问：http://localhost:1717
# 
# 注意事项：
# - 建议直接使用当前代码仓库目录下的 local-db 和 prisma 文件夹作为挂载路径
#   这样可以和 NPM 启动时的数据库路径保持一致
# - 数据库文件会在首次启动时自动初始化，无需手动执行 npm run db:push
# - 如果 local-db 或 prisma 目录不存在，Docker 会自动创建
# =============================================================================

services:
  # Easy Dataset 服务定义
  easy-dataset:
    # 使用的 Docker 镜像
    # ghcr.io/conardli/easy-dataset:1.6.1 是官方提供的预构建镜像
    # 版本号 1.6.1 可以根据需要修改为其他版本
    # 如果不指定版本号，将使用 latest 标签（最新版本）
    image: ghcr.io/conardli/easy-dataset:1.6.1
    
    # 容器名称
    # 用于标识和管理容器，可以通过 docker ps 查看
    # 如果名称已存在，需要先删除旧容器或使用不同的名称
    container_name: easy-dataset
    
    # 端口映射配置
    # 格式：'宿主机端口:容器内端口'
    # 1717:1717 表示将容器的 1717 端口映射到宿主机的 1717 端口
    # 这样可以通过 http://localhost:1717 访问应用
    # 如果需要使用其他端口（如 8080），可以修改为 '8080:1717'
    ports:
      - '1717:1717'
    
    # 数据卷挂载配置
    # 格式：'宿主机路径:容器内路径'
    # 用于持久化存储数据，即使容器删除，数据也不会丢失
    volumes:
      # 数据库文件挂载
      # ./local-db 是当前目录下的 local-db 文件夹（相对路径）
      # /app/local-db 是容器内的数据库存储路径
      # 数据库文件会保存在宿主机，确保数据持久化
      - ./local-db:/app/local-db
      
      # Prisma 配置文件挂载
      # Prisma 是一个现代化的数据库 ORM 工具
      # ./prisma 包含数据库模式和迁移文件
      # 挂载此目录可以确保数据库配置与本地开发环境一致
      # - ./prisma:/app/prisma
    
    # 容器重启策略
    # unless-stopped 表示：
    # - 容器会自动重启（除非手动停止）
    # - 即使 Docker 守护进程重启，容器也会自动启动
    # - 如果手动停止容器（docker stop），则不会自动重启
    # 其他可选值：
    #   no: 不自动重启（默认）
    #   always: 总是重启（即使手动停止）
    #   on-failure: 仅在退出码非 0 时重启
    restart: unless-stopped
